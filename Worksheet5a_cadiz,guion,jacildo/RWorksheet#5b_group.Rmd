---
title: "Worksheet#5B_group"
author: "Cadiz, Guion, Jacildo"
date: "2024-11-20"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# 1. Select 5 categories from Amazon and select 30 products from each category. 
# Guion
```{r}
library(rvest)
library(httr)
library(dplyr)
library(polite)
library(kableExtra)
library(rmarkdown)

makeup_url <- 'https://www.amazon.com/s?k=BLUSH+ON&rh=n%3A11058281&ref=nb_sb_noss'

session1 <- bow(makeup_url,
               user_agent = "Educational")
session1

```
```{r}
library(rvest)

amazondf1 <- data.frame()

page1 <- scrape(session1)

price1 <- page1 %>%
  html_nodes('.a-price .a-offscreen') %>% 
  html_text(trim = TRUE) %>% 
  gsub("[^0-9\\.]", "", .)

description1 <- page1 %>%
  html_nodes('.a-color-base.a-text-normal') %>% 
  html_text(trim = TRUE) %>%
  gsub("\n", "", .)

ratings1 <- page1 %>%
  html_nodes('.a-icon-alt') %>% 
  html_text() %>%
  gsub(" out of 5 stars", "", .)

reviews1 <- page1 %>%
  html_nodes('div.a-row.a-spacing-small.review-data') %>% 
  html_text()

price1 <- price1[1:min(30, length(price1))]
description1 <- description1[1:min(30, length(description1))]
ratings1 <- ratings1[1:min(30, length(ratings1))]
reviews1 <- reviews1[1:min(30, length(reviews1))]

price1 <- c(price1, rep(NA, 30 - length(price1)))
description1 <- c(description1, rep(NA, 30 - length(description1)))
ratings1 <- c(ratings1, rep(NA, 30 - length(ratings1)))
reviews1 <- c(reviews1, rep(NA, 30 - length(reviews1)))


amazondf1 <- data.frame(
  Prices_amazon = price1,
  Descriptions_amazon = description1,
  Ratings_amazon = ratings1,
  Reviewss_amazon = reviews1,
  stringsAsFactors = FALSE
)

print(amazondf1)


```

```{r}
skincare_url <- 'https://www.amazon.com/s?k=moisturizer&rh=n%3A11060451&ref=nb_sb_noss'

session2 <- bow(skincare_url,
               user_agent = "Educational")
session2
```
```{r}
library(rvest)

amazondf2 <- data.frame()

page2 <- scrape(session2)

price2 <- page2 %>%
  html_nodes('.a-price .a-offscreen') %>% 
  html_text(trim = TRUE) %>% 
  gsub("[^0-9\\.]", "", .)

description2 <- page2 %>%
  html_nodes('.a-color-base.a-text-normal') %>% 
  html_text(trim = TRUE) %>%
  gsub("\n", "", .)

ratings2 <- page2 %>%
  html_nodes('.a-icon-alt') %>% 
  html_text() %>%
  gsub(" out of 5 stars", "", .)

reviews2 <- page2 %>%
  html_nodes('div.a-row.a-spacing-small.review-data') %>% 
  html_text()

price2 <- price2[1:min(30, length(price2))]
description2 <- description2[1:min(30, length(description2))]
ratings2 <- ratings2[1:min(30, length(ratings2))]
reviews2 <- reviews2[1:min(30, length(reviews2))]

price2 <- c(price2, rep(NA, 30 - length(price2)))
description2 <- c(description2, rep(NA, 30 - length(description2)))
ratings2 <- c(ratings2, rep(NA, 30 - length(ratings2)))
reviews2 <- c(reviews2, rep(NA, 30 - length(reviews2)))


amazondf2 <- data.frame(
  Prices_amazon = price2,
  Descriptions_amazon = description2,
  Ratings_amazon = ratings2,
  Reviewss_amazon = reviews2,
  stringsAsFactors = FALSE
)

print(amazondf2)


```
```{r}
haircare_url <- 'https://www.amazon.com/s?k=shampoo&rh=n%3A11057241&ref=nb_sb_noss'

session3 <- bow(haircare_url,
               user_agent = "Educational")
session3
```
```{r}
library(rvest)

amazondf3 <- data.frame()

page3 <- scrape(session3)

price3 <- page3 %>%
  html_nodes('.a-price .a-offscreen') %>% 
  html_text(trim = TRUE) %>% 
  gsub("[^0-9\\.]", "", .)

description3 <- page3 %>%
  html_nodes('.a-color-base.a-text-normal') %>% 
  html_text(trim = TRUE) %>%
  gsub("\n", "", .)

ratings3 <- page3 %>%
  html_nodes('.a-icon-alt') %>% 
  html_text() %>%
  gsub(" out of 5 stars", "", .)

reviews3 <- page3 %>%
  html_nodes('div.a-row.a-spacing-small.review-data') %>% 
  html_text()

price3 <- price3[1:min(30, length(price3))]
description3 <- description3[1:min(30, length(description3))]
ratings3 <- ratings3[1:min(30, length(ratings3))]
reviews3 <- reviews3[1:min(30, length(reviews3))]

price3 <- c(price3, rep(NA, 30 - length(price3)))
description3 <- c(description3, rep(NA, 30 - length(description3)))
ratings3 <- c(ratings3, rep(NA, 30 - length(ratings3)))
reviews3 <- c(reviews3, rep(NA, 30 - length(reviews3)))


amazondf3 <- data.frame(
  Prices_amazon = price3,
  Descriptions_amazon = description3,
  Ratings_amazon = ratings3,
  Reviewss_amazon = reviews3,
  stringsAsFactors = FALSE
)

print(amazondf3)


```
```{r}
fragrance_url <- 'https://www.amazon.com/s?k=women&rh=n%3A11056591&ref=nb_sb_noss'

session4 <- bow(fragrance_url,
               user_agent = "Educational")
session4
```
```{r}
library(rvest)

amazondf4 <- data.frame()

page4 <- scrape(session4)

price4 <- page4 %>%
  html_nodes('.a-price .a-offscreen') %>% 
  html_text(trim = TRUE) %>% 
  gsub("[^0-9\\.]", "", .)

description4 <- page4 %>%
  html_nodes('.a-color-base.a-text-normal') %>% 
  html_text(trim = TRUE) %>%
  gsub("\n", "", .)

ratings4 <- page4 %>%
  html_nodes('.a-icon-alt') %>% 
  html_text() %>%
  gsub(" out of 5 stars", "", .)

reviews4 <- page4 %>%
  html_nodes('div.a-row.a-spacing-small.review-data') %>% 
  html_text()

price4 <- price4[1:min(30, length(price4))]
description4 <- description4[1:min(30, length(description4))]
ratings4 <- ratings4[1:min(30, length(ratings4))]
reviews4 <- reviews4[1:min(30, length(reviews4))]

price4 <- c(price4, rep(NA, 30 - length(price4)))
description4 <- c(description4, rep(NA, 30 - length(description4)))
ratings4 <- c(ratings4, rep(NA, 30 - length(ratings4)))
reviews4 <- c(reviews4, rep(NA, 30 - length(reviews4)))


amazondf4 <- data.frame(
  Prices_amazon = price4,
  Descriptions_amazon = description4,
  Ratings_amazon = ratings4,
  Reviewss_amazon = reviews4,
  stringsAsFactors = FALSE
)

print(amazondf4)


```
```{r}
oralcare_url <- 'https://www.amazon.com/s?k=toothbrush&rh=n%3A10079992011&ref=nb_sb_noss'

session5 <- bow(oralcare_url,
               user_agent = "Educational")
session5
```
```{r}
library(rvest)

amazondf5 <- data.frame()

page5 <- scrape(session5)

price5 <- page5 %>%
  html_nodes('.a-price .a-offscreen') %>% 
  html_text(trim = TRUE) %>% 
  gsub("[^0-9\\.]", "", .)

description5 <- page5 %>%
  html_nodes('.a-color-base.a-text-normal') %>% 
  html_text(trim = TRUE) %>%
  gsub("\n", "", .)

ratings5 <- page5 %>%
  html_nodes('.a-icon-alt') %>% 
  html_text() %>%
  gsub(" out of 5 stars", "", .)

reviews5 <- page5 %>%
  html_nodes('div.a-row.a-spacing-small.review-data') %>% 
  html_text()

price5 <- price5[1:min(30, length(price5))]
description5 <- description5[1:min(30, length(description5))]
ratings5 <- ratings5[1:min(30, length(ratings5))]
reviews5 <- reviews5[1:min(30, length(reviews5))]

price5 <- c(price5, rep(NA, 30 - length(price5)))
description5 <- c(description5, rep(NA, 30 - length(description5)))
ratings5 <- c(ratings5, rep(NA, 30 - length(ratings5)))
reviews5 <- c(reviews5, rep(NA, 30 - length(reviews5)))


amazondf5 <- data.frame(
  Prices_amazon = price5,
  Descriptions_amazon = description5,
  Ratings_amazon = ratings5,
  Reviewss_amazon = reviews5,
  stringsAsFactors = FALSE
)

print(amazondf5)


```
# 2. Out of the 30 products, pick 10 products and extract 20 reviews in each one which includes reviewer, date, individual rating, text review, title of review, and verified purchase.
```{r}
library(rvest)
library(dplyr)

product_urls <- c( 'https://www.amazon.com/Paris-Intense-Lightweight-Formula-Pigments/dp/B0CZTZKCJY/ref=sr_1_2_sspa?dib=eyJ2IjoiMSJ9.m0xIfnI1ubPsZII1mSHKUVBaNqKM_AvO0jAClyKTnp5JdjnLJYtKJWrnbyiY6_vAiX95MjY7BkwUB-0ZxYEWGt9LUpo8F5si75Wa7rqiFvfT8UFeq9Fx4q0r3oHqMkA0DhuQ43eLNYyl308k_cJLdYxcPBgV1lAc33k68Tv1ANajl3tdIOsfwQ_Oxu0TSb9FUiw3XGHL487oc2JaSFucOfvahuKXfrPwIzW9paFd5tkMrb1e4Bc5rJ5DeOJS2wxL_0JlRTAYkTA7V9COsVMByWCT9YDvsmarMorASHIdiyI.1XWmV0wwmyF232w8f3D-p5TONcuUdRZIR4xX07iEM3s&dib_tag=se&keywords=BLUSH+ON&qid=1732714372&s=beauty&sr=1-2-spons&sp_csd=d2lkZ2V0TmFtZT1zcF9hdGY&psc=1', #1  
  'https://www.amazon.com/LAURA-GELLER-NEW-YORK-Lightweight/dp/B0B64GX5LN/ref=sr_1_3_sspa?dib=eyJ2IjoiMSJ9.m0xIfnI1ubPsZII1mSHKUVBaNqKM_AvO0jAClyKTnp5JdjnLJYtKJWrnbyiY6_vAiX95MjY7BkwUB-0ZxYEWGt9LUpo8F5si75Wa7rqiFvfT8UFeq9Fx4q0r3oHqMkA0DhuQ43eLNYyl308k_cJLdYxcPBgV1lAc33k68Tv1ANajl3tdIOsfwQ_Oxu0TSb9FUiw3XGHL487oc2JaSFucOfvahuKXfrPwIzW9paFd5tkMrb1e4Bc5rJ5DeOJS2wxL_0JlRTAYkTA7V9COsVMByWCT9YDvsmarMorASHIdiyI.1XWmV0wwmyF232w8f3D-p5TONcuUdRZIR4xX07iEM3s&dib_tag=se&keywords=BLUSH+ON&qid=1732714372&s=beauty&sr=1-3-spons&sp_csd=d2lkZ2V0TmFtZT1zcF9hdGY&psc=1', #2
  'https://www.amazon.com/Hourglass-Unreal-Liquid-Blush-Scene/dp/B0DCXX5542/ref=sr_1_4_sspa?dib=eyJ2IjoiMSJ9.m0xIfnI1ubPsZII1mSHKUVBaNqKM_AvO0jAClyKTnp5JdjnLJYtKJWrnbyiY6_vAiX95MjY7BkwUB-0ZxYEWGt9LUpo8F5si75Wa7rqiFvfT8UFeq9Fx4q0r3oHqMkA0DhuQ43eLNYyl308k_cJLdYxcPBgV1lAc33k68Tv1ANajl3tdIOsfwQ_Oxu0TSb9FUiw3XGHL487oc2JaSFucOfvahuKXfrPwIzW9paFd5tkMrb1e4Bc5rJ5DeOJS2wxL_0JlRTAYkTA7V9COsVMByWCT9YDvsmarMorASHIdiyI.1XWmV0wwmyF232w8f3D-p5TONcuUdRZIR4xX07iEM3s&dib_tag=se&keywords=BLUSH+ON&qid=1732714372&s=beauty&sr=1-4-spons&sp_csd=d2lkZ2V0TmFtZT1zcF9hdGY&psc=1', #3
  'https://www.amazon.com/Maybelline-Lightweight-Blendable-Long-lasting-Enhancing/dp/B06XDYKJDJ/ref=sr_1_5?dib=eyJ2IjoiMSJ9.m0xIfnI1ubPsZII1mSHKUVBaNqKM_AvO0jAClyKTnp5JdjnLJYtKJWrnbyiY6_vAiX95MjY7BkwUB-0ZxYEWGt9LUpo8F5si75Wa7rqiFvfT8UFeq9Fx4q0r3oHqMkA0DhuQ43eLNYyl308k_cJLdYxcPBgV1lAc33k68Tv1ANajl3tdIOsfwQ_Oxu0TSb9FUiw3XGHL487oc2JaSFucOfvahuKXfrPwIzW9paFd5tkMrb1e4Bc5rJ5DeOJS2wxL_0JlRTAYkTA7V9COsVMByWCT9YDvsmarMorASHIdiyI.1XWmV0wwmyF232w8f3D-p5TONcuUdRZIR4xX07iEM3s&dib_tag=se&keywords=BLUSH+ON&qid=1732714372&s=beauty&sr=1-5', # 4
  'https://www.amazon.com/l-f-Monochromatic-Multi-Stick-Luminous/dp/B07MWSB1Z9/ref=sr_1_6?dib=eyJ2IjoiMSJ9.m0xIfnI1ubPsZII1mSHKUVBaNqKM_AvO0jAClyKTnp5JdjnLJYtKJWrnbyiY6_vAiX95MjY7BkwUB-0ZxYEWGt9LUpo8F5si75Wa7rqiFvfT8UFeq9Fx4q0r3oHqMkA0DhuQ43eLNYyl308k_cJLdYxcPBgV1lAc33k68Tv1ANajl3tdIOsfwQ_Oxu0TSb9FUiw3XGHL487oc2JaSFucOfvahuKXfrPwIzW9paFd5tkMrb1e4Bc5rJ5DeOJS2wxL_0JlRTAYkTA7V9COsVMByWCT9YDvsmarMorASHIdiyI.1XWmV0wwmyF232w8f3D-p5TONcuUdRZIR4xX07iEM3s&dib_tag=se&keywords=BLUSH+ON&qid=1732714372&s=beauty&sr=1-6', # 5
  'https://www.amazon.com/wet-wild-Effortless-Luxuriously-Cruelty-Free/dp/B082YPNTZ4/ref=sr_1_7?dib=eyJ2IjoiMSJ9.m0xIfnI1ubPsZII1mSHKUVBaNqKM_AvO0jAClyKTnp5JdjnLJYtKJWrnbyiY6_vAiX95MjY7BkwUB-0ZxYEWGt9LUpo8F5si75Wa7rqiFvfT8UFeq9Fx4q0r3oHqMkA0DhuQ43eLNYyl308k_cJLdYxcPBgV1lAc33k68Tv1ANajl3tdIOsfwQ_Oxu0TSb9FUiw3XGHL487oc2JaSFucOfvahuKXfrPwIzW9paFd5tkMrb1e4Bc5rJ5DeOJS2wxL_0JlRTAYkTA7V9COsVMByWCT9YDvsmarMorASHIdiyI.1XWmV0wwmyF232w8f3D-p5TONcuUdRZIR4xX07iEM3s&dib_tag=se&keywords=BLUSH+ON&qid=1732714372&s=beauty&sr=1-7', #6
  'https://www.amazon.com/wet-wild-Effortless-Luxuriously-Cruelty-Free/dp/B082YPNTZ4/ref=sr_1_7?dib=eyJ2IjoiMSJ9.m0xIfnI1ubPsZII1mSHKUVBaNqKM_AvO0jAClyKTnp5JdjnLJYtKJWrnbyiY6_vAiX95MjY7BkwUB-0ZxYEWGt9LUpo8F5si75Wa7rqiFvfT8UFeq9Fx4q0r3oHqMkA0DhuQ43eLNYyl308k_cJLdYxcPBgV1lAc33k68Tv1ANajl3tdIOsfwQ_Oxu0TSb9FUiw3XGHL487oc2JaSFucOfvahuKXfrPwIzW9paFd5tkMrb1e4Bc5rJ5DeOJS2wxL_0JlRTAYkTA7V9COsVMByWCT9YDvsmarMorASHIdiyI.1XWmV0wwmyF232w8f3D-p5TONcuUdRZIR4xX07iEM3s&dib_tag=se&keywords=BLUSH+ON&qid=1732714372&s=beauty&sr=1-7', #7 
  'https://www.amazon.com/SHEGLAM-Liquid-Makeup-Cheeks-Finish/dp/B0BN69MJ8H/ref=sr_1_9?dib=eyJ2IjoiMSJ9.m0xIfnI1ubPsZII1mSHKUVBaNqKM_AvO0jAClyKTnp5JdjnLJYtKJWrnbyiY6_vAiX95MjY7BkwUB-0ZxYEWGt9LUpo8F5si75Wa7rqiFvfT8UFeq9Fx4q0r3oHqMkA0DhuQ43eLNYyl308k_cJLdYxcPBgV1lAc33k68Tv1ANajl3tdIOsfwQ_Oxu0TSb9FUiw3XGHL487oc2JaSFucOfvahuKXfrPwIzW9paFd5tkMrb1e4Bc5rJ5DeOJS2wxL_0JlRTAYkTA7V9COsVMByWCT9YDvsmarMorASHIdiyI.1XWmV0wwmyF232w8f3D-p5TONcuUdRZIR4xX07iEM3s&dib_tag=se&keywords=BLUSH+ON&qid=1732714372&s=beauty&sr=1-9', # 8
  'https://www.amazon.com/Grande-Cosmetics-Peace-Love/dp/B0DFHQHNZH/ref=sr_1_3_sspa?qid=1732714239&s=beauty-intl-ship&sr=1-3-spons&sp_csd=d2lkZ2V0TmFtZT1zcF9hdGZfYnJvd3Nl&psc=1', # 9
  'https://www.amazon.com/Lamel-OhMy-Clear-Face-Powder/dp/B0CRHYWPDN/ref=sr_1_4_sspa?qid=1732714239&s=beauty-intl-ship&sr=1-4-spons&sp_csd=d2lkZ2V0TmFtZT1zcF9tdGZfYnJvd3Nl&psc=1')

scrape_reviews <- function(product_url) {
  
  review_page <- read_html(product_url)
  
  # Product name
  product_name <- review_page %>% 
    html_nodes('span#productTitle') %>% 
    html_text() %>%
    trimws()

  # Reviewers
  reviewers <- review_page %>%
    html_nodes('.a-profile-name') %>%
    html_text()

  # Review dates
  review_dates <- review_page %>%
    html_nodes('.a-size-base.a-color-secondary.review-date') %>%
    html_text()
  
  review_dates_clean <- gsub("Reviewed in the United States on ", "", review_dates)
  
   # Review titles
  review_titles <- review_page %>%
    html_nodes('.review-title') %>%
    html_text()
  review_titles_clean <- gsub("\\d+\\.\\d+ out of 5 stars", "", review_titles)
review_titles_clean <- trimws(review_titles_clean)

 # Extract Verified Purchase status
  verified_purchase <- review_page %>%
    html_nodes('span[data-hook="avp-badge-linkless"]') %>%
    html_text()

# Review Texts
  review_texts <- review_page %>%
    html_nodes('div[data-hook="review-collapsed"] span') %>%
    html_text() %>%
    trimws()
  
   # DataFrame
  reviews <- data.frame(
    Product = product_name[1:20],
    Reviewer = reviewers[1:20],
    Date = review_dates[1:20],
    ReviewTitle = review_titles[1:20],
 ReviewText = review_texts[1:20],
    VerifiedPurchase = verified_purchase[1:20],
    stringsAsFactors = FALSE
  )
  
  return(reviews)
}

all_reviews <- lapply(product_urls, scrape_reviews)
reviews_df <- bind_rows(all_reviews)

print(reviews_df)

```


